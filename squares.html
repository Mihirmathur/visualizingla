<!DOCTYPE html>
<html>
<style>
    body{
        background-color: #ddd225;
    }

    #grid{
        margin: 20px auto;
        width: 600px;
        height: 600px;
    }

    svg:hover{
        cursor: pointer;
    }

    svg.building{
        overflow: visible !important;
    }
</style>
<body>
    <div class="container">
        <div id="grid"></div>
    </div>
<script src="http://d3js.org/d3.v3.min.js"></script>
<script>

    var canvas = d3.select('#grid');

    var canvasWidth = canvas.node().getBoundingClientRect().width;
    var canvasHeight = canvas.node().getBoundingClientRect().height;

    function initSingleBuilding(buildingHeight, buildingWidth) {
        var data = new Array();
        var xpos = 1, ypos = 1,
            width = 5, height = 5;
        var off = 5,
            xOffset = 0,
            yOffset = 0;
        var xTrans = 0,
            yTrans = 0;

        for (var row = 0; row < buildingHeight/(height + off) - 1; row++) {
            data.push(new Array());
            for (var col = 0; col < buildingWidth/(width + off) - 1; col++) {
                data[row].push({
                    x: xpos,
                    y: ypos,
                    off: off,
                    width: width - off,
                    height: height - off,
                    xOffset: xOffset,
                    yOffset: yOffset,
                    xTrans: xTrans,
                    yTrans: yTrans
                })
                xOffset += off;
                xpos += width;
            }
            xOffset = 0;
            yOffset += off;
            xpos = 1;
            ypos += height; 
        }
        return data;
    }


    function initAllBuildings(arr){
        for (building of arr){
            var gridData = initSingleBuilding(building.height, building.width);

            var row = grid.append('svg')
                        .classed('building', true)
                        .attr('height', building.height)
                        .attr('width', building.width)
                    .selectAll('.row')
                    .data(gridData)
                    .enter().append('g')
                    .attr('class', 'row');

            var col = row.selectAll('rect')
                    .data(function(d) {return d;})
                    .enter().append('rect')
                    .attr('x', function(d) {return d.x;})
                    .attr('y', function(d) {return d.y;})
                    .attr('width', function(d) {return d.width + d.off;})
                    .attr('height', function(d) {return d.height + d.off;})
                    .attr('transform', function(d) {return 'translate(' + d.xOffset + ', ' + d.yOffset + ')';}) 
                    .style('fill', '#fff')
                    .on('mouseover', function(d){
                        var xOff = 30/(Math.random() - 0.5);
                        var yOff = 30/(Math.random() - 0.5);
                        d3.select(this)
                            .attr('xTrans', function(d){return xOff;})
                            .attr('yTrans', function(d){return yOff;})
                            .transition()
                            .duration(500)
                                .attr('transform', 'translate(' + xOff + ', ' + yOff + ')');
                    })
                    .on('mouseout', function(d){
                        d3.select(this)
                            .transition()
                            .delay(1000)
                            .duration(500)
                                .attr('transform', function(d){return 'translate(' + (-d.xTrans + d.xOffset) + ', ' + (-d.yTrans + d.yOffset) + ')';})
                            .attr('xTrans', 0)
                            .attr('yTrans', 0);
                    });
        }
    }
    var grid = canvas
        .append('g')
        .attr('width', canvasWidth)
        .attr('height', canvasHeight);

    initAllBuildings([
            {
                'height' : 300,
                'width' : 100
            },
            {
                'height' : 500,
                'width' : 50
            },
            {
                'height' : 400,
                'width' : 140
            },
            {
                'height' : 600,
                'width' : 120
            },
            {
                'height' : 370,
                'width' : 70
            },
            {
                'height' : 200,
                'width' : 50
            }
        ]);

    
</script>
</body>
</html>